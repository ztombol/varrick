# Varrick

Varrick is a convenient template engine written in shell script and using
`envsubst`. It substitutes references of the form `$var` and `${var}` with
environment variables using `envsubst`, while offering advanced features, e.g.
escaping support, over that of `envsubst`.

Varrick was primarily made to simplify configuration of Linux containers, but
can be used for other purposes as well.


# Motivation

Configuration files are often generated by replacing default values with
environment variables using `sed`. This is tedious and error prone in all but
the simplest cases.

A number of shell scripts attempt to remedy the situation and hide the gory
details of the process. They use `sed` or `eval` which are ill-suited to
implement substitution and end up cutting corners to avoid complexity. The
resulting, mostly undocumented, esoteric behaviour is left to the user to figure
out. Often a purpose built `sed`-based solution is a more viable option. Not
very convenient.

Good template engines exist in higher level languages, e.g. Perl or Python, but
their dependencies are too heavy to be considered viable for use in containers.

Existing solutions are either not robust enough to provide consistent behaviour
outside the simplest use cases or require large dependencies. This is what
Varrick wants to change.


# Design

Varrick was designed to be...

* Convenient - Intuitive, well-documented and consistent behaviour across all
  user input.
* Lightweight - Avoid using heavy dependencies, but don't reinvent the wheel.

To achieve these goals Varrick uses the following strategies.

* Implement in shell script. The supported shells are already available on
  most systems and containers.
* Use `envsubst` instead of `sed` or `eval` for substitution. Most problems of
  existing shell based solutions come from the fact that they use the wrong tool
  for the job. `envsubst` was made solely for substituting environment variables
  in shell format strings. It is also part of `gettext` which is readily
  available on most systems and containers.
* Thorough testing. Tests are written using the excellent [Bats][bats-gh] framework.
  Accompanying libraries are unit tested.
* Good documentation. Concise user and developer documentation to eliminate
  learning curve and ease maintenance.


# Example

TODO(ztombol): Add examples including a walkthrough of creating a template that
               uses escaping!


# Dependencies

Varrick has the following dependencies.

* A supported shell. Currently only `bash` is supported, but `bash` specific
  syntax was intentionally avoided in many cases to ease porting in the future.
* [`envsubst`][envsubst-hp] from [`gettext`][gettext-hp]
* [`sed`][sed-hp]
* `getopt` from [`util-linux`][util-linux-hp]
* basic utilities, e.g. `cat` or `ls`, from [`coreutils`][coreutils-hp]


# Name

The name *"Varrick"* did not materialise until shortly before the first release.
It emerged from the test string *"Do the thing!"* that was used especially a lot
in the early revisions. Not surprisingly the library doing the heavy lifting
behind Varrick is called *"Zhu-Li"*.


<!-- References -->

[bats-gh]: https://github.com/sstephenson/bats
[envsubst-hp]: https://www.gnu.org/software/gettext/manual/html_node/envsubst-Invocation.html
[gettext-hp]: https://www.gnu.org/software/gettext/
[coreutils-hp]: http://www.gnu.org/software/coreutils/
[util-linux-hp]: https://www.kernel.org/pub/linux/utils/util-linux/
[sed-hp]: https://www.gnu.org/software/sed/
[wikia-varrick]: http://avatar.wikia.com/wiki/Iknik_Blackstone_Varrick
[wikia-zhu-li]: http://avatar.wikia.com/wiki/Zhu_Li_Moon
